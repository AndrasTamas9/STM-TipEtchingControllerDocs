<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM Tip Etching Controller: Mod2Mode Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STM Tip Etching Controller
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-types">Private Types</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classMod2Mode-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">Mod2Mode Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Mode for surface detection, etching validation, and pulsed 9 V processing (MOD2).  
 <a href="classMod2Mode.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Modes_8h_source.html">Modes.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for Mod2Mode:</div>
<div class="dyncontent">
<div class="center"><img src="classMod2Mode__inherit__graph.png" border="0" usemap="#aMod2Mode_inherit__map" alt="Inheritance graph"/></div>
<map name="aMod2Mode_inherit__map" id="aMod2Mode_inherit__map">
<area shape="rect" title="Mode for surface detection, etching validation, and pulsed 9 V processing (MOD2)." alt="" coords="5,79,100,104"/>
<area shape="rect" href="structIMode.html" title="Interface for non&#45;blocking machine modes." alt="" coords="21,5,84,31"/>
<area shape="poly" title=" " alt="" coords="55,44,55,79,50,79,50,44"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for Mod2Mode:</div>
<div class="dyncontent">
<div class="center"><img src="classMod2Mode__coll__graph.png" border="0" usemap="#aMod2Mode_coll__map" alt="Collaboration graph"/></div>
<map name="aMod2Mode_coll__map" id="aMod2Mode_coll__map">
<area shape="rect" title="Mode for surface detection, etching validation, and pulsed 9 V processing (MOD2)." alt="" coords="201,108,296,133"/>
<area shape="rect" href="structIMode.html" title="Interface for non&#45;blocking machine modes." alt="" coords="5,5,68,31"/>
<area shape="poly" title=" " alt="" coords="73,34,171,82,224,105,222,110,169,86,71,39"/>
<area shape="rect" href="classLcd1602.html" title="Wrapper class for a 16x2 HD44780&#45;compatible LCD with PWM backlight control." alt="" coords="92,5,168,31"/>
<area shape="poly" title=" " alt="" coords="156,37,237,106,233,110,152,41"/>
<area shape="rect" href="classStepperDriver.html" title="Non&#45;blocking stepper motor driver with position and velocity control." alt="" coords="193,5,305,31"/>
<area shape="poly" title=" " alt="" coords="251,45,251,108,246,108,246,45"/>
<area shape="rect" href="classCurrentSensor.html" title="Non&#45;blocking RMS current measurement helper class." alt="" coords="329,5,443,31"/>
<area shape="poly" title=" " alt="" coords="367,43,317,86,275,110,272,106,314,82,364,39"/>
<area shape="rect" href="classMovingAverage.html" title="Fixed&#45;point, static moving average filter." alt="" coords="468,5,680,31"/>
<area shape="poly" title=" " alt="" coords="538,39,479,63,412,87,297,114,296,109,411,81,477,58,536,34"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:adbe17078a45c1b52f8a519255363c0aa" id="r_adbe17078a45c1b52f8a519255363c0aa"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#adbe17078a45c1b52f8a519255363c0aa">Mod2Mode</a> (<a class="el" href="classLcd1602.html">Lcd1602</a> &amp;lcd, <a class="el" href="classStepperDriver.html">StepperDriver</a> &amp;stepper, uint8_t relayPin1, uint8_t relayPin2, <a class="el" href="classCurrentSensor.html">CurrentSensor</a> &amp;current, float surfaceThreshold, float etchingThreshold, <a class="el" href="Modes_8h.html#ab04955aa9a0cde03c3f19b89d606528b">IAvg_t</a> &amp;Iavg, <a class="el" href="Modes_8h.html#adf369259dddd95255442495a6f6fa96f">IAvg_s</a> &amp;IavgS)</td></tr>
<tr class="memdesc:adbe17078a45c1b52f8a519255363c0aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new <a class="el" href="classMod2Mode.html" title="Mode for surface detection, etching validation, and pulsed 9 V processing (MOD2).">Mod2Mode</a> instance.  <br /></td></tr>
<tr class="separator:adbe17078a45c1b52f8a519255363c0aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9bf1cab467b095d0ae9b17fcfa6451a7" id="r_a9bf1cab467b095d0ae9b17fcfa6451a7"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a9bf1cab467b095d0ae9b17fcfa6451a7">name</a> () const override</td></tr>
<tr class="memdesc:a9bf1cab467b095d0ae9b17fcfa6451a7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the name of this mode.  <br /></td></tr>
<tr class="separator:a9bf1cab467b095d0ae9b17fcfa6451a7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fb9e060e1716ae9c15d25667c09c1e5" id="r_a0fb9e060e1716ae9c15d25667c09c1e5"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a0fb9e060e1716ae9c15d25667c09c1e5">begin</a> () override</td></tr>
<tr class="memdesc:a0fb9e060e1716ae9c15d25667c09c1e5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize MOD2 mode.  <br /></td></tr>
<tr class="separator:a0fb9e060e1716ae9c15d25667c09c1e5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f1d92665e2e76621d86460e6a6b67e1" id="r_a0f1d92665e2e76621d86460e6a6b67e1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a0f1d92665e2e76621d86460e6a6b67e1">step</a> () override</td></tr>
<tr class="memdesc:a0f1d92665e2e76621d86460e6a6b67e1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute one step of the MOD2 state machine.  <br /></td></tr>
<tr class="separator:a0f1d92665e2e76621d86460e6a6b67e1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0fa0d62e0279bc87e128dddf7508da57" id="r_a0fa0d62e0279bc87e128dddf7508da57"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a0fa0d62e0279bc87e128dddf7508da57">end</a> () override</td></tr>
<tr class="memdesc:a0fa0d62e0279bc87e128dddf7508da57"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup performed when leaving MOD2 mode.  <br /></td></tr>
<tr class="separator:a0fa0d62e0279bc87e128dddf7508da57"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_structIMode"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_structIMode')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="structIMode.html">IMode</a></td></tr>
<tr class="memitem:aa6d28f0a2c76d54fa7cc452b5efee520 inherit pub_methods_structIMode" id="r_aa6d28f0a2c76d54fa7cc452b5efee520"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structIMode.html#aa6d28f0a2c76d54fa7cc452b5efee520">~IMode</a> ()</td></tr>
<tr class="memdesc:aa6d28f0a2c76d54fa7cc452b5efee520 inherit pub_methods_structIMode"><td class="mdescLeft">&#160;</td><td class="mdescRight">Virtual destructor for proper cleanup via base pointers.  <br /></td></tr>
<tr class="separator:aa6d28f0a2c76d54fa7cc452b5efee520 inherit pub_methods_structIMode"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-types" name="pri-types"></a>
Private Types</h2></td></tr>
<tr class="memitem:a05b9dc474c68a70b9d04a217c30e7e97" id="r_a05b9dc474c68a70b9d04a217c30e7e97"><td class="memItemLeft" align="right" valign="top">enum class &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97">State</a> : uint8_t { <br />
&#160;&#160;<a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97afa585d32a02170e5d4aada3bd490a1b3">MovingDownDetect</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97a0aea9cb3445215834a9c673e8a87afb0">Wait1</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97ae5d725300be2a3224f5ef30d542cc8a1">MoveDown1</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97a0e8f4b6b678f165db16f833d2fa58224">Wait2</a>
, <br />
&#160;&#160;<a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97a94d75119d47b1832d9f82c203d4ec3cc">Validate30V</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97aee175b2d6ca4f79e6620824b6218a105">RelayHold</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97a22c82b647ac61b701febb720888a8fbb">Wait3</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97a13b54a41a2963717ba261533d6679ec0">MoveDown2</a>
, <br />
&#160;&#160;<a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97ac93375fedfa466e246febcd4d7be738b">Wait4</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97a80cc480f21ef8694cbd0a3820a07996a">RelayPulse</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97a4f43702c684b13d2eb3c97f642cb4c62">FinalLift</a>
, <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97af92965e2c8a7afb3c1b9a5c09a263636">Done</a>
<br />
 }</td></tr>
<tr class="memdesc:a05b9dc474c68a70b9d04a217c30e7e97"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal state machine for MOD2 mode.  <a href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97">More...</a><br /></td></tr>
<tr class="separator:a05b9dc474c68a70b9d04a217c30e7e97"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:aa5d6e58dfe54cf2be8133cddb041c577" id="r_aa5d6e58dfe54cf2be8133cddb041c577"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLcd1602.html">Lcd1602</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#aa5d6e58dfe54cf2be8133cddb041c577">lcd_</a></td></tr>
<tr class="memdesc:aa5d6e58dfe54cf2be8133cddb041c577"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to the LCD for user-facing messages.  <br /></td></tr>
<tr class="separator:aa5d6e58dfe54cf2be8133cddb041c577"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0187d4704a760def10d52f653c50159b" id="r_a0187d4704a760def10d52f653c50159b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStepperDriver.html">StepperDriver</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a0187d4704a760def10d52f653c50159b">stepper_</a></td></tr>
<tr class="memdesc:a0187d4704a760def10d52f653c50159b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to the stepper driver for Z motion.  <br /></td></tr>
<tr class="separator:a0187d4704a760def10d52f653c50159b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adee39dcd26380c3e6a8ed61ae3c911c5" id="r_adee39dcd26380c3e6a8ed61ae3c911c5"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#adee39dcd26380c3e6a8ed61ae3c911c5">relayPin1_</a></td></tr>
<tr class="memdesc:adee39dcd26380c3e6a8ed61ae3c911c5"><td class="mdescLeft">&#160;</td><td class="mdescRight">First relay control pin (HV switching).  <br /></td></tr>
<tr class="separator:adee39dcd26380c3e6a8ed61ae3c911c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a731cd289d53899ef9aa66486de9a6468" id="r_a731cd289d53899ef9aa66486de9a6468"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a731cd289d53899ef9aa66486de9a6468">relayPin2_</a></td></tr>
<tr class="memdesc:a731cd289d53899ef9aa66486de9a6468"><td class="mdescLeft">&#160;</td><td class="mdescRight">Second relay control pin (HV switching).  <br /></td></tr>
<tr class="separator:a731cd289d53899ef9aa66486de9a6468"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab81cd1d51870e3b5060a80c179e37f1c" id="r_ab81cd1d51870e3b5060a80c179e37f1c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classCurrentSensor.html">CurrentSensor</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#ab81cd1d51870e3b5060a80c179e37f1c">current_</a></td></tr>
<tr class="memdesc:ab81cd1d51870e3b5060a80c179e37f1c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to the current sensor used for current-based thresholds.  <br /></td></tr>
<tr class="separator:ab81cd1d51870e3b5060a80c179e37f1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a439e7f505f8461afc46673f93a8ada0b" id="r_a439e7f505f8461afc46673f93a8ada0b"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a439e7f505f8461afc46673f93a8ada0b">threshold_</a></td></tr>
<tr class="memdesc:a439e7f505f8461afc46673f93a8ada0b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Threshold for initial surface detection based on current.  <br /></td></tr>
<tr class="separator:a439e7f505f8461afc46673f93a8ada0b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa8ec23fa8b6bcd91d8916f7ced25762d" id="r_aa8ec23fa8b6bcd91d8916f7ced25762d"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#aa8ec23fa8b6bcd91d8916f7ced25762d">etchingThreshold_</a></td></tr>
<tr class="memdesc:aa8ec23fa8b6bcd91d8916f7ced25762d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Threshold for decisions during etching/hold stages.  <br /></td></tr>
<tr class="separator:aa8ec23fa8b6bcd91d8916f7ced25762d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac49ade6646e730321903056827031d78" id="r_ac49ade6646e730321903056827031d78"><td class="memItemLeft" align="right" valign="top"><a class="el" href="Modes_8h.html#ab04955aa9a0cde03c3f19b89d606528b">IAvg_t</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#ac49ade6646e730321903056827031d78">Iavg_</a></td></tr>
<tr class="memdesc:ac49ade6646e730321903056827031d78"><td class="mdescLeft">&#160;</td><td class="mdescRight">Long-window moving average for current.  <br /></td></tr>
<tr class="separator:ac49ade6646e730321903056827031d78"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afdd9b4d7e00c12dabb6b85fbf7f5a0c2" id="r_afdd9b4d7e00c12dabb6b85fbf7f5a0c2"><td class="memItemLeft" align="right" valign="top"><a class="el" href="Modes_8h.html#adf369259dddd95255442495a6f6fa96f">IAvg_s</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#afdd9b4d7e00c12dabb6b85fbf7f5a0c2">IavgS_</a></td></tr>
<tr class="memdesc:afdd9b4d7e00c12dabb6b85fbf7f5a0c2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Short-window moving average for current.  <br /></td></tr>
<tr class="separator:afdd9b4d7e00c12dabb6b85fbf7f5a0c2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad948f1dc269eccd1020ff5653dc14a47" id="r_ad948f1dc269eccd1020ff5653dc14a47"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97">State</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#ad948f1dc269eccd1020ff5653dc14a47">st_</a> = <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97afa585d32a02170e5d4aada3bd490a1b3">State::MovingDownDetect</a></td></tr>
<tr class="memdesc:ad948f1dc269eccd1020ff5653dc14a47"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current state in the MOD2 state machine.  <br /></td></tr>
<tr class="separator:ad948f1dc269eccd1020ff5653dc14a47"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aebb173f31d1b76d8d8d3852fbd9582bd" id="r_aebb173f31d1b76d8d8d3852fbd9582bd"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#aebb173f31d1b76d8d8d3852fbd9582bd">waitStart_</a> = 0</td></tr>
<tr class="memdesc:aebb173f31d1b76d8d8d3852fbd9582bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generic timestamp (ms) used for various waits.  <br /></td></tr>
<tr class="separator:aebb173f31d1b76d8d8d3852fbd9582bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9198f93d5b2e1e6f9cf4577918d3180f" id="r_a9198f93d5b2e1e6f9cf4577918d3180f"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a9198f93d5b2e1e6f9cf4577918d3180f">validateStart_</a> = 0</td></tr>
<tr class="memdesc:a9198f93d5b2e1e6f9cf4577918d3180f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp (ms) marking the start of the 30 V validation phase.  <br /></td></tr>
<tr class="separator:a9198f93d5b2e1e6f9cf4577918d3180f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a699e628dfc0d4bc44e1c75526b47c77d" id="r_a699e628dfc0d4bc44e1c75526b47c77d"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a699e628dfc0d4bc44e1c75526b47c77d">pulseStart_</a> = 0</td></tr>
<tr class="memdesc:a699e628dfc0d4bc44e1c75526b47c77d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp (ms) marking the start of the current pulse phase.  <br /></td></tr>
<tr class="separator:a699e628dfc0d4bc44e1c75526b47c77d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad914a80d319035fb63ff732c83ba21fa" id="r_ad914a80d319035fb63ff732c83ba21fa"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#ad914a80d319035fb63ff732c83ba21fa">etchStart_</a> = 0</td></tr>
<tr class="memdesc:ad914a80d319035fb63ff732c83ba21fa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Timestamp (ms) marking the start of the 30 V hold/etching phase.  <br /></td></tr>
<tr class="separator:ad914a80d319035fb63ff732c83ba21fa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a673450877df759da1ef7dac79bcdf163" id="r_a673450877df759da1ef7dac79bcdf163"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a673450877df759da1ef7dac79bcdf163">relayOn_</a> = false</td></tr>
<tr class="memdesc:a673450877df759da1ef7dac79bcdf163"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag indicating whether the relay is currently ON (true) or OFF (false).  <br /></td></tr>
<tr class="separator:a673450877df759da1ef7dac79bcdf163"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1f5a4f421c8a4dc8a2ace8744d1aed20" id="r_a1f5a4f421c8a4dc8a2ace8744d1aed20"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classMod2Mode.html#a1f5a4f421c8a4dc8a2ace8744d1aed20">pulseCount_</a> = 0</td></tr>
<tr class="memdesc:a1f5a4f421c8a4dc8a2ace8744d1aed20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of 9 V pulse cycles executed.  <br /></td></tr>
<tr class="separator:a1f5a4f421c8a4dc8a2ace8744d1aed20"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Mode for surface detection, etching validation, and pulsed 9 V processing (MOD2). </p>
<p>High-level behavior:</p><ul>
<li>Detect surface via current threshold while moving downward.</li>
<li>Perform a controlled plunge and a short 30 V validation pulse.</li>
<li>Once validated, hold 30 V for a period with current monitoring and then switch it off when a condition is met.</li>
<li>Execute additional downward motion and finally apply a series of 9 V pulses configured by Parameters.</li>
<li>Lift the tool by a fixed amount and finish. </li>
</ul>
</div><h2 class="groupheader">Member Enumeration Documentation</h2>
<a id="a05b9dc474c68a70b9d04a217c30e7e97" name="a05b9dc474c68a70b9d04a217c30e7e97"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a05b9dc474c68a70b9d04a217c30e7e97">&#9670;&#160;</a></span>State</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">enum class <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97">Mod2Mode::State</a> : uint8_t</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">strong</span><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Internal state machine for MOD2 mode. </p>
<p>States:</p><ul>
<li>MovingDownDetect : downward motion looking for surface via current.</li>
<li>Wait1 : delay after initial detection.</li>
<li>MoveDown1 : additional downward move.</li>
<li>Wait2 : pause before validation.</li>
<li>Validate30V : short 30 V validation pulse to confirm contact.</li>
<li>RelayHold : hold 30 V, monitor current.</li>
<li>Wait3 : pause after turning 30 V off.</li>
<li>MoveDown2 : additional downward motion after etch.</li>
<li>Wait4 : pause before starting 9 V pulses.</li>
<li>RelayPulse : series of 9 V ON/OFF pulses.</li>
<li>FinalLift : final upward motion applied at the end.</li>
<li>Done : terminal state indicating completion. </li>
</ul>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97afa585d32a02170e5d4aada3bd490a1b3" name="a05b9dc474c68a70b9d04a217c30e7e97afa585d32a02170e5d4aada3bd490a1b3"></a>MovingDownDetect&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97a0aea9cb3445215834a9c673e8a87afb0" name="a05b9dc474c68a70b9d04a217c30e7e97a0aea9cb3445215834a9c673e8a87afb0"></a>Wait1&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97ae5d725300be2a3224f5ef30d542cc8a1" name="a05b9dc474c68a70b9d04a217c30e7e97ae5d725300be2a3224f5ef30d542cc8a1"></a>MoveDown1&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97a0e8f4b6b678f165db16f833d2fa58224" name="a05b9dc474c68a70b9d04a217c30e7e97a0e8f4b6b678f165db16f833d2fa58224"></a>Wait2&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97a94d75119d47b1832d9f82c203d4ec3cc" name="a05b9dc474c68a70b9d04a217c30e7e97a94d75119d47b1832d9f82c203d4ec3cc"></a>Validate30V&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97aee175b2d6ca4f79e6620824b6218a105" name="a05b9dc474c68a70b9d04a217c30e7e97aee175b2d6ca4f79e6620824b6218a105"></a>RelayHold&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97a22c82b647ac61b701febb720888a8fbb" name="a05b9dc474c68a70b9d04a217c30e7e97a22c82b647ac61b701febb720888a8fbb"></a>Wait3&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97a13b54a41a2963717ba261533d6679ec0" name="a05b9dc474c68a70b9d04a217c30e7e97a13b54a41a2963717ba261533d6679ec0"></a>MoveDown2&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97ac93375fedfa466e246febcd4d7be738b" name="a05b9dc474c68a70b9d04a217c30e7e97ac93375fedfa466e246febcd4d7be738b"></a>Wait4&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97a80cc480f21ef8694cbd0a3820a07996a" name="a05b9dc474c68a70b9d04a217c30e7e97a80cc480f21ef8694cbd0a3820a07996a"></a>RelayPulse&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97a4f43702c684b13d2eb3c97f642cb4c62" name="a05b9dc474c68a70b9d04a217c30e7e97a4f43702c684b13d2eb3c97f642cb4c62"></a>FinalLift&#160;</td><td class="fielddoc"></td></tr>
<tr><td class="fieldname"><a id="a05b9dc474c68a70b9d04a217c30e7e97af92965e2c8a7afb3c1b9a5c09a263636" name="a05b9dc474c68a70b9d04a217c30e7e97af92965e2c8a7afb3c1b9a5c09a263636"></a>Done&#160;</td><td class="fielddoc"></td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="adbe17078a45c1b52f8a519255363c0aa" name="adbe17078a45c1b52f8a519255363c0aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adbe17078a45c1b52f8a519255363c0aa">&#9670;&#160;</a></span>Mod2Mode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Mod2Mode::Mod2Mode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLcd1602.html">Lcd1602</a> &amp;&#160;</td>
          <td class="paramname"><em>lcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classStepperDriver.html">StepperDriver</a> &amp;&#160;</td>
          <td class="paramname"><em>stepper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>relayPin1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>relayPin2</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCurrentSensor.html">CurrentSensor</a> &amp;&#160;</td>
          <td class="paramname"><em>current</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>surfaceThreshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>etchingThreshold</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="Modes_8h.html#ab04955aa9a0cde03c3f19b89d606528b">IAvg_t</a> &amp;&#160;</td>
          <td class="paramname"><em>Iavg</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="Modes_8h.html#adf369259dddd95255442495a6f6fa96f">IAvg_s</a> &amp;&#160;</td>
          <td class="paramname"><em>IavgS</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct a new <a class="el" href="classMod2Mode.html" title="Mode for surface detection, etching validation, and pulsed 9 V processing (MOD2).">Mod2Mode</a> instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lcd</td><td>Reference to the LCD for messages and prompts. </td></tr>
    <tr><td class="paramname">stepper</td><td>Reference to the stepper driver for Z motion. </td></tr>
    <tr><td class="paramname">relayPin1</td><td>First relay control pin (part of 30 V / 9 V switching). </td></tr>
    <tr><td class="paramname">relayPin2</td><td>Second relay control pin (part of 30 V / 9 V switching). </td></tr>
    <tr><td class="paramname">current</td><td>Reference to the current sensor used for detection. </td></tr>
    <tr><td class="paramname">surfaceThreshold</td><td>Threshold for initial surface detection. </td></tr>
    <tr><td class="paramname">etchingThreshold</td><td>Threshold for decisions during etching/hold phases. </td></tr>
    <tr><td class="paramname">Iavg</td><td>Long-window moving average for current. </td></tr>
    <tr><td class="paramname">IavgS</td><td>Short-window moving average for current. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0fb9e060e1716ae9c15d25667c09c1e5" name="a0fb9e060e1716ae9c15d25667c09c1e5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fb9e060e1716ae9c15d25667c09c1e5">&#9670;&#160;</a></span>begin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Mod2Mode::begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize MOD2 mode. </p>
<p>Initialize MOD2 mode (surface detection + validation + pulsed 9 V).</p>
<p>Configures relay pins, state machine variables, current-averaging filters, and motion parameters for downward surface search and subsequent processing.</p>
<p>Behavior:</p><ul>
<li>Displays initial mode information on the LCD.</li>
<li>Configures relay pins and turns everything off.</li>
<li>Sets up state machine variables and enables the stepper motor.</li>
<li>Begins moving downward to detect the surface using current thresholding.</li>
<li>Enables current measurement for detection and validation phases. </li>
</ul>

<p>Implements <a class="el" href="structIMode.html#abf4c7c5e1758fc13058dac1dd0675982">IMode</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMod2Mode_a0fb9e060e1716ae9c15d25667c09c1e5_cgraph.png" border="0" usemap="#aclassMod2Mode_a0fb9e060e1716ae9c15d25667c09c1e5_cgraph" alt=""/></div>
<map name="aclassMod2Mode_a0fb9e060e1716ae9c15d25667c09c1e5_cgraph" id="aclassMod2Mode_a0fb9e060e1716ae9c15d25667c09c1e5_cgraph">
<area shape="rect" title="Initialize MOD2 mode." alt="" coords="5,84,144,109"/>
<area shape="rect" href="classStepperDriver.html#a08ddf3dd4e038a8818de8a7200ddb4ec" title="Enable or disable the stepper driver." alt="" coords="213,5,377,31"/>
<area shape="poly" title=" " alt="" coords="98,81,141,60,191,39,216,32,218,37,193,45,143,65,101,86"/>
<area shape="rect" href="classCurrentSensor.html#a908e354d16c44c67d2be1b501e18bfc7" title="Enable or disable measurement updates." alt="" coords="197,55,392,80"/>
<area shape="poly" title=" " alt="" coords="144,85,185,79,186,85,145,90"/>
<area shape="rect" href="classStepperDriver.html#a8fa4f67459e8366e83a2827fc4e8cf3a" title="Set continuous motion speed in mm/s." alt="" coords="192,105,397,145"/>
<area shape="poly" title=" " alt="" coords="145,103,179,107,178,113,144,108"/>
<area shape="rect" href="classLcd1602.html#a7004efb68a9891924331923c69706d52" title="Display two lines of flash&#45;resident text as a title." alt="" coords="235,169,354,195"/>
<area shape="poly" title=" " alt="" coords="98,107,141,131,193,154,223,164,222,169,191,159,139,136,96,112"/>
</map>
</div>

</div>
</div>
<a id="a0fa0d62e0279bc87e128dddf7508da57" name="a0fa0d62e0279bc87e128dddf7508da57"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0fa0d62e0279bc87e128dddf7508da57">&#9670;&#160;</a></span>end()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void Mod2Mode::end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cleanup performed when leaving MOD2 mode. </p>
<p>Cleanup for MOD2 mode.</p>
<p>Stops and enables the stepper, disables current measurement, and switches relays to a safe OFF configuration.</p>
<p>Ensures:</p><ul>
<li>the stepper motor is stopped and enabled,</li>
<li>current measurement is disabled,</li>
<li>all relays are turned off (safe state). </li>
</ul>

<p>Implements <a class="el" href="structIMode.html#acc782a6205322e642a56aa122c8e0512">IMode</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMod2Mode_a0fa0d62e0279bc87e128dddf7508da57_cgraph.png" border="0" usemap="#aclassMod2Mode_a0fa0d62e0279bc87e128dddf7508da57_cgraph" alt=""/></div>
<map name="aclassMod2Mode_a0fa0d62e0279bc87e128dddf7508da57_cgraph" id="aclassMod2Mode_a0fa0d62e0279bc87e128dddf7508da57_cgraph">
<area shape="rect" title="Cleanup performed when leaving MOD2 mode." alt="" coords="5,55,132,80"/>
<area shape="rect" href="classStepperDriver.html#a08ddf3dd4e038a8818de8a7200ddb4ec" title="Enable or disable the stepper driver." alt="" coords="201,5,365,31"/>
<area shape="poly" title=" " alt="" coords="124,52,213,31,214,36,125,57"/>
<area shape="rect" href="classCurrentSensor.html#a908e354d16c44c67d2be1b501e18bfc7" title="Enable or disable measurement updates." alt="" coords="185,55,380,80"/>
<area shape="poly" title=" " alt="" coords="132,65,172,65,172,70,132,70"/>
<area shape="rect" href="classStepperDriver.html#a8fa4f67459e8366e83a2827fc4e8cf3a" title="Set continuous motion speed in mm/s." alt="" coords="180,105,385,145"/>
<area shape="poly" title=" " alt="" coords="118,77,195,99,194,104,116,83"/>
</map>
</div>

</div>
</div>
<a id="a9bf1cab467b095d0ae9b17fcfa6451a7" name="a9bf1cab467b095d0ae9b17fcfa6451a7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9bf1cab467b095d0ae9b17fcfa6451a7">&#9670;&#160;</a></span>name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char * Mod2Mode::name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the name of this mode. </p>
<dl class="section return"><dt>Returns</dt><dd>Constant C-string "MOD2". </dd></dl>

<p>Implements <a class="el" href="structIMode.html#a531317dbb9f073f46bd6b7330ffc58e7">IMode</a>.</p>

</div>
</div>
<a id="a0f1d92665e2e76621d86460e6a6b67e1" name="a0f1d92665e2e76621d86460e6a6b67e1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f1d92665e2e76621d86460e6a6b67e1">&#9670;&#160;</a></span>step()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Mod2Mode::step </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute one step of the MOD2 state machine. </p>
<p>Execute one step of the MOD2 mode state machine.</p>
<p>Drives MOD2 through its phases: surface detection, validation, 30 V hold, additional motion, 9 V pulse sequence, and final lift. Non-blocking; call repeatedly until it returns true.</p>
<dl class="section return"><dt>Returns</dt><dd>true when MOD2 has completed and control should return to the menu, </dd>
<dd>
false while the mode is still running.</dd></dl>
<p>High-level sequence:</p><ol type="1">
<li>Move downward until the corrected RMS current exceeds a threshold (surface detection).</li>
<li>After a short wait, move down further (plunge), wait again, then:<ul>
<li>turn 30 V on for validation,</li>
<li>confirm or reject surface contact based on current.</li>
</ul>
</li>
<li>Once validated:<ul>
<li>hold 30 V on (RelayHold) while monitoring current,</li>
<li>turn 30 V off and log current when a condition is met.</li>
</ul>
</li>
<li>After another wait, move down again, wait, then:<ul>
<li>disable current measurement,</li>
<li>apply a series of 9 V pulses (RelayPulse) according to configured parameters,</li>
<li>finally lift by 30 mm and finish.</li>
</ul>
</li>
</ol>
<p>Safety:</p><ul>
<li>A global Z limit aborts the mode immediately if exceeded.</li>
</ul>
<dl class="section return"><dt>Returns</dt><dd>true when the mode has fully completed, </dd>
<dd>
false while the mode is still in progress. </dd></dl>

<p>Implements <a class="el" href="structIMode.html#a9fc61504224e0961d659341cde1140da">IMode</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classMod2Mode_a0f1d92665e2e76621d86460e6a6b67e1_cgraph.png" border="0" usemap="#aclassMod2Mode_a0f1d92665e2e76621d86460e6a6b67e1_cgraph" alt=""/></div>
<map name="aclassMod2Mode_a0f1d92665e2e76621d86460e6a6b67e1_cgraph" id="aclassMod2Mode_a0f1d92665e2e76621d86460e6a6b67e1_cgraph">
<area shape="rect" title="Execute one step of the MOD2 state machine." alt="" coords="5,280,136,305"/>
<area shape="rect" href="classCurrentSensor.html#a45514ec38e38d1ae4194ee6e07c90917" title="Get the baseline&#45;corrected RMS current." alt="" coords="196,5,408,31"/>
<area shape="poly" title=" " alt="" coords="71,279,80,233,99,168,113,133,132,99,155,67,182,40,188,36,191,40,186,44,159,71,136,102,118,135,104,170,85,235,76,280"/>
<area shape="rect" href="classStepperDriver.html#a4a66821f431c4db6d4f030c6b7003bd8" title="Check whether the driver is busy with a position move." alt="" coords="221,55,383,80"/>
<area shape="poly" title=" " alt="" coords="73,279,84,241,105,189,138,135,158,110,182,89,206,76,208,81,186,94,162,114,142,138,110,192,89,243,78,281"/>
<area shape="rect" href="classStepperDriver.html#a388099ce07ad1e470799bab91943d2e0" title="Start a non&#45;blocking relative move (mm)." alt="" coords="184,104,420,129"/>
<area shape="poly" title=" " alt="" coords="76,278,115,215,146,178,183,146,212,131,214,136,185,151,149,182,119,218,81,281"/>
<area shape="rect" href="classStepperDriver.html#a4d1715971817716be1a64e8b5c6c2197" title="Get the current logical position in millimeters." alt="" coords="468,155,665,180"/>
<area shape="poly" title=" " alt="" coords="79,278,120,233,150,209,183,190,251,169,322,157,391,153,454,153,454,159,391,158,322,162,252,174,185,195,153,213,124,237,83,282"/>
<area shape="rect" href="classLcd1602.html#a2922193bbb32f7cad2c48c5ad0f21f0c" title="Print a RAM&#45;resident C&#45;string." alt="" coords="245,205,359,231"/>
<area shape="poly" title=" " alt="" coords="95,278,135,258,183,239,230,227,231,232,185,245,138,263,97,282"/>
<area shape="rect" href="classMovingAverage.html#a84bdaf0937897d8baacad7cd1a927eac" title="Reset the filter contents and accumulator." alt="" coords="220,255,384,280"/>
<area shape="poly" title=" " alt="" coords="136,283,206,275,206,280,137,288"/>
<area shape="rect" href="classLcd1602.html#a0516b78aa7f4531924a132d2b256f534" title="Position the cursor." alt="" coords="229,304,375,329"/>
<area shape="poly" title=" " alt="" coords="137,297,215,305,215,310,136,302"/>
<area shape="rect" href="classCurrentSensor.html#a908e354d16c44c67d2be1b501e18bfc7" title="Enable or disable measurement updates." alt="" coords="205,353,399,379"/>
<area shape="poly" title=" " alt="" coords="99,303,185,338,219,348,218,353,183,343,97,308"/>
<area shape="rect" href="classStepperDriver.html#a8fa4f67459e8366e83a2827fc4e8cf3a" title="Set continuous motion speed in mm/s." alt="" coords="199,403,405,443"/>
<area shape="poly" title=" " alt="" coords="85,304,127,345,155,368,185,388,203,396,200,401,183,392,152,372,123,349,81,307"/>
<area shape="rect" href="classLcd1602.html#a7004efb68a9891924331923c69706d52" title="Display two lines of flash&#45;resident text as a title." alt="" coords="243,468,361,493"/>
<area shape="poly" title=" " alt="" coords="79,305,93,336,116,376,147,418,186,453,207,464,230,471,228,476,205,469,182,458,143,422,111,379,89,338,75,307"/>
<area shape="rect" href="classStepperDriver.html#ac202361e6f613a083200d36f664d64e7" title="Non&#45;blocking step scheduling; call frequently from loop()." alt="" coords="219,517,385,543"/>
<area shape="poly" title=" " alt="" coords="77,305,88,345,109,399,141,456,161,482,186,504,207,516,205,521,182,508,158,486,136,459,104,401,83,346,72,306"/>
<area shape="rect" href="classMovingAverage.html#ab66a3b068e54504c4cd58da6378b29d4" title="Insert a new floating&#45;point sample and compute the updated average." alt="" coords="214,567,390,592"/>
<area shape="poly" title=" " alt="" coords="76,305,84,353,102,420,117,457,135,493,158,525,186,553,202,564,199,568,182,557,154,529,130,495,112,459,97,422,79,354,71,306"/>
<area shape="rect" href="classStepperDriver.html#a3a28a7c422746be35ae93f227169972b" title="Start a non&#45;blocking move to an absolute position (mm)." alt="" coords="469,104,665,129"/>
<area shape="poly" title=" " alt="" coords="420,114,455,114,455,119,420,119"/>
<area shape="poly" title=" " alt="" coords="370,127,487,149,486,155,369,132"/>
<area shape="rect" href="classStepperDriver.html#acb72803a8fdbf2bd2e645b36a3d0306c" title="Emit a single step pulse and update the internal position counter." alt="" coords="473,517,661,543"/>
<area shape="poly" title=" " alt="" coords="385,527,459,527,459,533,385,533"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="ab81cd1d51870e3b5060a80c179e37f1c" name="ab81cd1d51870e3b5060a80c179e37f1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab81cd1d51870e3b5060a80c179e37f1c">&#9670;&#160;</a></span>current_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classCurrentSensor.html">CurrentSensor</a>&amp; Mod2Mode::current_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to the current sensor used for current-based thresholds. </p>

</div>
</div>
<a id="aa8ec23fa8b6bcd91d8916f7ced25762d" name="aa8ec23fa8b6bcd91d8916f7ced25762d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa8ec23fa8b6bcd91d8916f7ced25762d">&#9670;&#160;</a></span>etchingThreshold_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float Mod2Mode::etchingThreshold_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Threshold for decisions during etching/hold stages. </p>

</div>
</div>
<a id="ad914a80d319035fb63ff732c83ba21fa" name="ad914a80d319035fb63ff732c83ba21fa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad914a80d319035fb63ff732c83ba21fa">&#9670;&#160;</a></span>etchStart_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long Mod2Mode::etchStart_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timestamp (ms) marking the start of the 30 V hold/etching phase. </p>

</div>
</div>
<a id="ac49ade6646e730321903056827031d78" name="ac49ade6646e730321903056827031d78"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac49ade6646e730321903056827031d78">&#9670;&#160;</a></span>Iavg_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Modes_8h.html#ab04955aa9a0cde03c3f19b89d606528b">IAvg_t</a>&amp; Mod2Mode::Iavg_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Long-window moving average for current. </p>

</div>
</div>
<a id="afdd9b4d7e00c12dabb6b85fbf7f5a0c2" name="afdd9b4d7e00c12dabb6b85fbf7f5a0c2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afdd9b4d7e00c12dabb6b85fbf7f5a0c2">&#9670;&#160;</a></span>IavgS_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="Modes_8h.html#adf369259dddd95255442495a6f6fa96f">IAvg_s</a>&amp; Mod2Mode::IavgS_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Short-window moving average for current. </p>

</div>
</div>
<a id="aa5d6e58dfe54cf2be8133cddb041c577" name="aa5d6e58dfe54cf2be8133cddb041c577"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa5d6e58dfe54cf2be8133cddb041c577">&#9670;&#160;</a></span>lcd_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLcd1602.html">Lcd1602</a>&amp; Mod2Mode::lcd_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to the LCD for user-facing messages. </p>

</div>
</div>
<a id="a1f5a4f421c8a4dc8a2ace8744d1aed20" name="a1f5a4f421c8a4dc8a2ace8744d1aed20"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1f5a4f421c8a4dc8a2ace8744d1aed20">&#9670;&#160;</a></span>pulseCount_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t Mod2Mode::pulseCount_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of 9 V pulse cycles executed. </p>

</div>
</div>
<a id="a699e628dfc0d4bc44e1c75526b47c77d" name="a699e628dfc0d4bc44e1c75526b47c77d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a699e628dfc0d4bc44e1c75526b47c77d">&#9670;&#160;</a></span>pulseStart_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long Mod2Mode::pulseStart_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timestamp (ms) marking the start of the current pulse phase. </p>

</div>
</div>
<a id="a673450877df759da1ef7dac79bcdf163" name="a673450877df759da1ef7dac79bcdf163"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a673450877df759da1ef7dac79bcdf163">&#9670;&#160;</a></span>relayOn_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool Mod2Mode::relayOn_ = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag indicating whether the relay is currently ON (true) or OFF (false). </p>

</div>
</div>
<a id="adee39dcd26380c3e6a8ed61ae3c911c5" name="adee39dcd26380c3e6a8ed61ae3c911c5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#adee39dcd26380c3e6a8ed61ae3c911c5">&#9670;&#160;</a></span>relayPin1_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t Mod2Mode::relayPin1_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>First relay control pin (HV switching). </p>

</div>
</div>
<a id="a731cd289d53899ef9aa66486de9a6468" name="a731cd289d53899ef9aa66486de9a6468"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a731cd289d53899ef9aa66486de9a6468">&#9670;&#160;</a></span>relayPin2_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t Mod2Mode::relayPin2_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Second relay control pin (HV switching). </p>

</div>
</div>
<a id="ad948f1dc269eccd1020ff5653dc14a47" name="ad948f1dc269eccd1020ff5653dc14a47"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad948f1dc269eccd1020ff5653dc14a47">&#9670;&#160;</a></span>st_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97">State</a> Mod2Mode::st_ = <a class="el" href="classMod2Mode.html#a05b9dc474c68a70b9d04a217c30e7e97afa585d32a02170e5d4aada3bd490a1b3">State::MovingDownDetect</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Current state in the MOD2 state machine. </p>

</div>
</div>
<a id="a0187d4704a760def10d52f653c50159b" name="a0187d4704a760def10d52f653c50159b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0187d4704a760def10d52f653c50159b">&#9670;&#160;</a></span>stepper_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStepperDriver.html">StepperDriver</a>&amp; Mod2Mode::stepper_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to the stepper driver for Z motion. </p>

</div>
</div>
<a id="a439e7f505f8461afc46673f93a8ada0b" name="a439e7f505f8461afc46673f93a8ada0b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a439e7f505f8461afc46673f93a8ada0b">&#9670;&#160;</a></span>threshold_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float Mod2Mode::threshold_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Threshold for initial surface detection based on current. </p>

</div>
</div>
<a id="a9198f93d5b2e1e6f9cf4577918d3180f" name="a9198f93d5b2e1e6f9cf4577918d3180f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a9198f93d5b2e1e6f9cf4577918d3180f">&#9670;&#160;</a></span>validateStart_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long Mod2Mode::validateStart_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Timestamp (ms) marking the start of the 30 V validation phase. </p>

</div>
</div>
<a id="aebb173f31d1b76d8d8d3852fbd9582bd" name="aebb173f31d1b76d8d8d3852fbd9582bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aebb173f31d1b76d8d8d3852fbd9582bd">&#9670;&#160;</a></span>waitStart_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long Mod2Mode::waitStart_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generic timestamp (ms) used for various waits. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Modes_8h_source.html">Modes.h</a></li>
<li><a class="el" href="Modes_8cpp.html">Modes.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
