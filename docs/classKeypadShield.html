<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM Tip Etching Controller: KeypadShield Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STM Tip Etching Controller
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-methods">Private Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classKeypadShield-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">KeypadShield Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Non-blocking keypad handler for analog-resistor ladder shields.  
 <a href="classKeypadShield.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="KeypadShield_8h_source.html">KeypadShield.h</a>&gt;</code></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a8ae4bdc59d1ef00cbc9844faee0637d4" id="r_a8ae4bdc59d1ef00cbc9844faee0637d4"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a8ae4bdc59d1ef00cbc9844faee0637d4">KeypadShield</a> (uint8_t analogPin, uint16_t debounceMs=50)</td></tr>
<tr class="memdesc:a8ae4bdc59d1ef00cbc9844faee0637d4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new <a class="el" href="classKeypadShield.html" title="Non-blocking keypad handler for analog-resistor ladder shields.">KeypadShield</a> object.  <br /></td></tr>
<tr class="separator:a8ae4bdc59d1ef00cbc9844faee0637d4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aaaa9cff6c6dc0ac4d4f545301c1a38ee" id="r_aaaa9cff6c6dc0ac4d4f545301c1a38ee"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#aaaa9cff6c6dc0ac4d4f545301c1a38ee">begin</a> ()</td></tr>
<tr class="memdesc:aaaa9cff6c6dc0ac4d4f545301c1a38ee"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the keypad shield.  <br /></td></tr>
<tr class="separator:aaaa9cff6c6dc0ac4d4f545301c1a38ee"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a35b5757cf10ad1d38bbf9061c2d2b11b" id="r_a35b5757cf10ad1d38bbf9061c2d2b11b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a35b5757cf10ad1d38bbf9061c2d2b11b">poll</a> ()</td></tr>
<tr class="memdesc:a35b5757cf10ad1d38bbf9061c2d2b11b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Poll the keypad and return a single key-press edge event.  <br /></td></tr>
<tr class="separator:a35b5757cf10ad1d38bbf9061c2d2b11b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a88107445356e42dd346231d899802d4b" id="r_a88107445356e42dd346231d899802d4b"><td class="memItemLeft" align="right" valign="top"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a88107445356e42dd346231d899802d4b">stable</a> () const</td></tr>
<tr class="memdesc:a88107445356e42dd346231d899802d4b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the current stable key state.  <br /></td></tr>
<tr class="separator:a88107445356e42dd346231d899802d4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ec185ab1bf87e202b6e8f06780afbed" id="r_a3ec185ab1bf87e202b6e8f06780afbed"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a3ec185ab1bf87e202b6e8f06780afbed">setThresholds</a> (int right, int up, int down, int left, int select)</td></tr>
<tr class="memdesc:a3ec185ab1bf87e202b6e8f06780afbed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the ADC thresholds used to classify keys.  <br /></td></tr>
<tr class="separator:a3ec185ab1bf87e202b6e8f06780afbed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a56c3d96e5cb551c05d612f1ca18af3f1" id="r_a56c3d96e5cb551c05d612f1ca18af3f1"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a56c3d96e5cb551c05d612f1ca18af3f1">clear</a> ()</td></tr>
<tr class="memdesc:a56c3d96e5cb551c05d612f1ca18af3f1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Clear all stored key state and reset debouncing.  <br /></td></tr>
<tr class="separator:a56c3d96e5cb551c05d612f1ca18af3f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-methods" name="pri-methods"></a>
Private Member Functions</h2></td></tr>
<tr class="memitem:aa6ccf3a8934dadd07bfafddb75cc015d" id="r_aa6ccf3a8934dadd07bfafddb75cc015d"><td class="memItemLeft" align="right" valign="top"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#aa6ccf3a8934dadd07bfafddb75cc015d">classify_</a> (int adc) const</td></tr>
<tr class="memdesc:aa6ccf3a8934dadd07bfafddb75cc015d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Classify a raw ADC reading into a Key value.  <br /></td></tr>
<tr class="separator:aa6ccf3a8934dadd07bfafddb75cc015d"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a2001b05a3efd76eba4d910a08050acfe" id="r_a2001b05a3efd76eba4d910a08050acfe"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a2001b05a3efd76eba4d910a08050acfe">aPin_</a></td></tr>
<tr class="memdesc:a2001b05a3efd76eba4d910a08050acfe"><td class="mdescLeft">&#160;</td><td class="mdescRight">Analog pin connected to the keypad resistor ladder.  <br /></td></tr>
<tr class="separator:a2001b05a3efd76eba4d910a08050acfe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afe6da707c6fbc2a65a7e6aa489c7ef7c" id="r_afe6da707c6fbc2a65a7e6aa489c7ef7c"><td class="memItemLeft" align="right" valign="top">uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#afe6da707c6fbc2a65a7e6aa489c7ef7c">dbMs_</a></td></tr>
<tr class="memdesc:afe6da707c6fbc2a65a7e6aa489c7ef7c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Debounce interval in milliseconds.  <br /></td></tr>
<tr class="separator:afe6da707c6fbc2a65a7e6aa489c7ef7c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43d027c1a8e6d5756c2f8efa2fa38e95" id="r_a43d027c1a8e6d5756c2f8efa2fa38e95"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a43d027c1a8e6d5756c2f8efa2fa38e95">lastChange_</a> = 0</td></tr>
<tr class="memdesc:a43d027c1a8e6d5756c2f8efa2fa38e95"><td class="mdescLeft">&#160;</td><td class="mdescRight">Last time (in ms) when the raw key state changed, used for debouncing.  <br /></td></tr>
<tr class="separator:a43d027c1a8e6d5756c2f8efa2fa38e95"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a614301cd9c76980a5c4c6baa5ca1b5b5" id="r_a614301cd9c76980a5c4c6baa5ca1b5b5"><td class="memItemLeft" align="right" valign="top"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a614301cd9c76980a5c4c6baa5ca1b5b5">stable_</a> = <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a></td></tr>
<tr class="memdesc:a614301cd9c76980a5c4c6baa5ca1b5b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Current stable (debounced) key state.  <br /></td></tr>
<tr class="separator:a614301cd9c76980a5c4c6baa5ca1b5b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acc0be892b7cc790becce56982c1624c7" id="r_acc0be892b7cc790becce56982c1624c7"><td class="memItemLeft" align="right" valign="top"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#acc0be892b7cc790becce56982c1624c7">last_</a> = <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a></td></tr>
<tr class="memdesc:acc0be892b7cc790becce56982c1624c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Last instantaneous (raw, non-debounced) key state.  <br /></td></tr>
<tr class="separator:acc0be892b7cc790becce56982c1624c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3ba1a5789b7b14c8ec9cb45cf1306840" id="r_a3ba1a5789b7b14c8ec9cb45cf1306840"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a3ba1a5789b7b14c8ec9cb45cf1306840">thRight_</a> = 60</td></tr>
<tr class="memdesc:a3ba1a5789b7b14c8ec9cb45cf1306840"><td class="mdescLeft">&#160;</td><td class="mdescRight">ADC thresholds used to distinguish keys.  <br /></td></tr>
<tr class="separator:a3ba1a5789b7b14c8ec9cb45cf1306840"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2dee94d9217872f4d7a84de450d8b9e2" id="r_a2dee94d9217872f4d7a84de450d8b9e2"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a2dee94d9217872f4d7a84de450d8b9e2">thUp_</a> = 200</td></tr>
<tr class="separator:a2dee94d9217872f4d7a84de450d8b9e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3e1066ddc2d6fee749b2ada3808f47a1" id="r_a3e1066ddc2d6fee749b2ada3808f47a1"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a3e1066ddc2d6fee749b2ada3808f47a1">thDown_</a> = 400</td></tr>
<tr class="separator:a3e1066ddc2d6fee749b2ada3808f47a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8295c6e1eb946b0b0d6bf3127e47ba8c" id="r_a8295c6e1eb946b0b0d6bf3127e47ba8c"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a8295c6e1eb946b0b0d6bf3127e47ba8c">thLeft_</a> = 600</td></tr>
<tr class="separator:a8295c6e1eb946b0b0d6bf3127e47ba8c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7a0c30915ca0d9ad2f2532308e79b6ce" id="r_a7a0c30915ca0d9ad2f2532308e79b6ce"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classKeypadShield.html#a7a0c30915ca0d9ad2f2532308e79b6ce">thSel_</a> = 800</td></tr>
<tr class="separator:a7a0c30915ca0d9ad2f2532308e79b6ce"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Non-blocking keypad handler for analog-resistor ladder shields. </p>
<p><a class="el" href="classKeypadShield.html" title="Non-blocking keypad handler for analog-resistor ladder shields.">KeypadShield</a> reads an analog input connected to a keypad (e.g. DFR0009) where each key press produces a distinct voltage level. Internally, it:</p><ul>
<li>classifies raw ADC readings into Key values using configurable thresholds,</li>
<li>applies time-based debouncing,</li>
<li>provides edge-triggered key events via <a class="el" href="classKeypadShield.html#a35b5757cf10ad1d38bbf9061c2d2b11b" title="Poll the keypad and return a single key-press edge event.">poll()</a>,</li>
<li>exposes the current stable key state via <a class="el" href="classKeypadShield.html#a88107445356e42dd346231d899802d4b" title="Get the current stable key state.">stable()</a>.</li>
</ul>
<p>The class is intended to be polled frequently from the main loop without blocking delays. </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a8ae4bdc59d1ef00cbc9844faee0637d4" name="a8ae4bdc59d1ef00cbc9844faee0637d4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8ae4bdc59d1ef00cbc9844faee0637d4">&#9670;&#160;</a></span>KeypadShield()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">KeypadShield::KeypadShield </td>
          <td>(</td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>analogPin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint16_t&#160;</td>
          <td class="paramname"><em>debounceMs</em> = <code>50</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">explicit</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct a new <a class="el" href="classKeypadShield.html" title="Non-blocking keypad handler for analog-resistor ladder shields.">KeypadShield</a> object. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">analogPin</td><td>Analog pin connected to the keypad resistor ladder. </td></tr>
    <tr><td class="paramname">debounceMs</td><td>Debounce interval in milliseconds used to confirm that a key state is stable before generating events.</td></tr>
    <tr><td class="paramname">analogPin</td><td>Analog pin connected to the keypad resistor ladder. </td></tr>
    <tr><td class="paramname">debounceMs</td><td>Debounce time in milliseconds used to confirm a stable key state. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="aaaa9cff6c6dc0ac4d4f545301c1a38ee" name="aaaa9cff6c6dc0ac4d4f545301c1a38ee"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aaaa9cff6c6dc0ac4d4f545301c1a38ee">&#9670;&#160;</a></span>begin()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void KeypadShield::begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize the keypad shield. </p>
<p>Initialize the keypad shield state.</p>
<p>This method should be called once (typically in setup()). It resets the internal key state and initializes the debounce timer.</p>
<p>This method should be called once (typically in setup()). It resets the internal stable and last key states and initializes the timestamp used for debouncing. </p>

</div>
</div>
<a id="aa6ccf3a8934dadd07bfafddb75cc015d" name="aa6ccf3a8934dadd07bfafddb75cc015d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa6ccf3a8934dadd07bfafddb75cc015d">&#9670;&#160;</a></span>classify_()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a> KeypadShield::classify_ </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>a</em></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Classify a raw ADC reading into a Key value. </p>
<p>Classify a raw ADC reading into a Key enum value.</p>
<p>The given ADC reading is compared against the stored thresholds in order. The first threshold that is greater than the reading determines the key. If the reading is greater than all thresholds, <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">adc</td><td>Raw ADC reading. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Corresponding key or <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> if no valid key is matched.</dd></dl>
<p>The thresholds define contiguous intervals associated with each button. The reading is compared in ascending order; the first threshold exceeded determines the key. If the value is above all thresholds, <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> is returned.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">a</td><td>Raw ADC reading (0..ADC max). </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>Corresponding Key value, or <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> if no key matches. </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classKeypadShield_aa6ccf3a8934dadd07bfafddb75cc015d_icgraph.png" border="0" usemap="#aclassKeypadShield_aa6ccf3a8934dadd07bfafddb75cc015d_icgraph" alt=""/></div>
<map name="aclassKeypadShield_aa6ccf3a8934dadd07bfafddb75cc015d_icgraph" id="aclassKeypadShield_aa6ccf3a8934dadd07bfafddb75cc015d_icgraph">
<area shape="rect" title="Classify a raw ADC reading into a Key value." alt="" coords="403,5,577,31"/>
<area shape="rect" href="classKeypadShield.html#a35b5757cf10ad1d38bbf9061c2d2b11b" title="Poll the keypad and return a single key&#45;press edge event." alt="" coords="212,5,355,31"/>
<area shape="poly" title=" " alt="" coords="389,21,355,21,355,15,389,15"/>
<area shape="rect" href="classModeController.html#a165f893bcea976bafa17090c99b79098" title="Main update function to be called from the Arduino loop()." alt="" coords="5,5,164,31"/>
<area shape="poly" title=" " alt="" coords="198,21,164,21,164,15,198,15"/>
</map>
</div>

</div>
</div>
<a id="a56c3d96e5cb551c05d612f1ca18af3f1" name="a56c3d96e5cb551c05d612f1ca18af3f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a56c3d96e5cb551c05d612f1ca18af3f1">&#9670;&#160;</a></span>clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void KeypadShield::clear </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Clear all stored key state and reset debouncing. </p>
<p>Clear any stored key state and reset the debounce timer.</p>
<p>After calling this, the keypad behaves as if no key has previously been pressed: stable_ and last_ are reset to <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a>, and the debounce timer is restarted.</p>
<p>After calling this function, the keypad behaves as if no key has been pressed yet: the stable and last keys are set to <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> and the debounce timer is restarted. </p>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classKeypadShield_a56c3d96e5cb551c05d612f1ca18af3f1_icgraph.png" border="0" usemap="#aclassKeypadShield_a56c3d96e5cb551c05d612f1ca18af3f1_icgraph" alt=""/></div>
<map name="aclassKeypadShield_a56c3d96e5cb551c05d612f1ca18af3f1_icgraph" id="aclassKeypadShield_a56c3d96e5cb551c05d612f1ca18af3f1_icgraph">
<area shape="rect" title="Clear all stored key state and reset debouncing." alt="" coords="221,31,372,56"/>
<area shape="rect" href="classJogMode.html#ad4fa13b121783048cd1b04cf8bef04de" title="Execute one step of JOG behavior." alt="" coords="32,5,147,31"/>
<area shape="poly" title=" " alt="" coords="207,35,146,28,147,22,208,30"/>
<area shape="rect" href="classParametersMode.html#ae6288ee6a57c034054af8903c678a341" title="Execute one non&#45;blocking step of the parameter editing logic." alt="" coords="5,55,173,80"/>
<area shape="poly" title=" " alt="" coords="208,56,174,60,173,55,207,51"/>
</map>
</div>

</div>
</div>
<a id="a35b5757cf10ad1d38bbf9061c2d2b11b" name="a35b5757cf10ad1d38bbf9061c2d2b11b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a35b5757cf10ad1d38bbf9061c2d2b11b">&#9670;&#160;</a></span>poll()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a> KeypadShield::poll </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Poll the keypad and return a single key-press edge event. </p>
<p>Poll the keypad and return a newly detected key press (edge).</p>
<p>This function:</p><ul>
<li>reads the analog input,</li>
<li>classifies the reading as a logical key,</li>
<li>applies debouncing based on debounceMs,</li>
<li>returns a key value only when a new stable key press is detected.</li>
</ul>
<p>It returns <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> if no new key press event has occurred since the previous call. It does not block and should be called regularly in the main loop.</p>
<dl class="section return"><dt>Returns</dt><dd>The newly detected key press (e.g. <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5a21507b40c80068eda19865706fdc2403">Key::RIGHT</a>, <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5a63225f19fccb18e7c709f1fa11bc738e">Key::SELECT</a>) or <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> if no new event is available.</dd></dl>
<p>This method performs a non-blocking read of the analog pin, classifies the current raw key, and applies a debounce mechanism:</p><ul>
<li>If the raw key state changes, the debounce timer is reset.</li>
<li>Only when the raw state remains unchanged for at least dbMs_ milliseconds is the stable state updated.</li>
<li>The method returns a non-NONE key only when a new stable key is detected (i.e., edge detection on key press). If no new key press event occurs, <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> is returned.</li>
</ul>
<p>Typical usage: call <a class="el" href="classKeypadShield.html#a35b5757cf10ad1d38bbf9061c2d2b11b" title="Poll the keypad and return a single key-press edge event.">poll()</a> in the main loop and react only when the return value is not <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a>.</p>
<dl class="section return"><dt>Returns</dt><dd>The newly detected key press (<a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5a21507b40c80068eda19865706fdc2403">Key::RIGHT</a>, <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5a684d325a7303f52e64011467ff5c5758">Key::LEFT</a>, etc.) or <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> if no new key press occurred. </dd></dl>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_cgraph.png" border="0" usemap="#aclassKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_cgraph" alt=""/></div>
<map name="aclassKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_cgraph" id="aclassKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_cgraph">
<area shape="rect" title="Poll the keypad and return a single key&#45;press edge event." alt="" coords="5,5,148,31"/>
<area shape="rect" href="classKeypadShield.html#aa6ccf3a8934dadd07bfafddb75cc015d" title="Classify a raw ADC reading into a Key value." alt="" coords="196,5,371,31"/>
<area shape="poly" title=" " alt="" coords="148,15,182,15,182,21,148,21"/>
</map>
</div>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_icgraph.png" border="0" usemap="#aclassKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_icgraph" alt=""/></div>
<map name="aclassKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_icgraph" id="aclassKeypadShield_a35b5757cf10ad1d38bbf9061c2d2b11b_icgraph">
<area shape="rect" title="Poll the keypad and return a single key&#45;press edge event." alt="" coords="212,5,355,31"/>
<area shape="rect" href="classModeController.html#a165f893bcea976bafa17090c99b79098" title="Main update function to be called from the Arduino loop()." alt="" coords="5,5,164,31"/>
<area shape="poly" title=" " alt="" coords="198,21,164,21,164,15,198,15"/>
</map>
</div>

</div>
</div>
<a id="a3ec185ab1bf87e202b6e8f06780afbed" name="a3ec185ab1bf87e202b6e8f06780afbed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ec185ab1bf87e202b6e8f06780afbed">&#9670;&#160;</a></span>setThresholds()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void KeypadShield::setThresholds </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>right</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>up</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>down</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>left</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>select</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the ADC thresholds used to classify keys. </p>
<p>Configure ADC thresholds for each key.</p>
<p>The keypad usually forms a resistor ladder: each button press results in a distinct analog value. These thresholds partition the ADC range into segments associated with each key. They are expected to be in ascending order.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">right</td><td>Threshold value for the RIGHT key. </td></tr>
    <tr><td class="paramname">up</td><td>Threshold value for the UP key. </td></tr>
    <tr><td class="paramname">down</td><td>Threshold value for the DOWN key. </td></tr>
    <tr><td class="paramname">left</td><td>Threshold value for the LEFT key. </td></tr>
    <tr><td class="paramname">select</td><td>Threshold value for the SELECT key.</td></tr>
  </table>
  </dd>
</dl>
<p>The keypad is typically implemented as a resistor ladder where each button press produces a different analog value. This function sets the upper threshold for each key region in ascending order. The classification logic compares the ADC reading against these thresholds to determine which key is pressed.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">right</td><td>Threshold for the RIGHT key. </td></tr>
    <tr><td class="paramname">up</td><td>Threshold for the UP key. </td></tr>
    <tr><td class="paramname">down</td><td>Threshold for the DOWN key. </td></tr>
    <tr><td class="paramname">left</td><td>Threshold for the LEFT key. </td></tr>
    <tr><td class="paramname">select</td><td>Threshold for the SELECT key. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a88107445356e42dd346231d899802d4b" name="a88107445356e42dd346231d899802d4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a88107445356e42dd346231d899802d4b">&#9670;&#160;</a></span>stable()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a> KeypadShield::stable </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the current stable key state. </p>
<p>This returns the debounced key that is currently considered pressed. It remains non-NONE as long as the key is held down and the analog reading remains within the corresponding threshold range.</p>
<dl class="section return"><dt>Returns</dt><dd>The current stable key (or <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a> if no key is pressed). </dd></dl>
<div class="dynheader">
Here is the caller graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classKeypadShield_a88107445356e42dd346231d899802d4b_icgraph.png" border="0" usemap="#aclassKeypadShield_a88107445356e42dd346231d899802d4b_icgraph" alt=""/></div>
<map name="aclassKeypadShield_a88107445356e42dd346231d899802d4b_icgraph" id="aclassKeypadShield_a88107445356e42dd346231d899802d4b_icgraph">
<area shape="rect" title="Get the current stable key state." alt="" coords="221,31,380,56"/>
<area shape="rect" href="classJogMode.html#ad4fa13b121783048cd1b04cf8bef04de" title="Execute one step of JOG behavior." alt="" coords="32,5,147,31"/>
<area shape="poly" title=" " alt="" coords="207,35,147,28,148,22,208,30"/>
<area shape="rect" href="classParametersMode.html#ae6288ee6a57c034054af8903c678a341" title="Execute one non&#45;blocking step of the parameter editing logic." alt="" coords="5,55,173,80"/>
<area shape="poly" title=" " alt="" coords="208,57,174,60,173,55,207,51"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a2001b05a3efd76eba4d910a08050acfe" name="a2001b05a3efd76eba4d910a08050acfe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2001b05a3efd76eba4d910a08050acfe">&#9670;&#160;</a></span>aPin_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t KeypadShield::aPin_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Analog pin connected to the keypad resistor ladder. </p>

</div>
</div>
<a id="afe6da707c6fbc2a65a7e6aa489c7ef7c" name="afe6da707c6fbc2a65a7e6aa489c7ef7c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#afe6da707c6fbc2a65a7e6aa489c7ef7c">&#9670;&#160;</a></span>dbMs_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint16_t KeypadShield::dbMs_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Debounce interval in milliseconds. </p>

</div>
</div>
<a id="acc0be892b7cc790becce56982c1624c7" name="acc0be892b7cc790becce56982c1624c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acc0be892b7cc790becce56982c1624c7">&#9670;&#160;</a></span>last_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a> KeypadShield::last_ = <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Last instantaneous (raw, non-debounced) key state. </p>

</div>
</div>
<a id="a43d027c1a8e6d5756c2f8efa2fa38e95" name="a43d027c1a8e6d5756c2f8efa2fa38e95"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43d027c1a8e6d5756c2f8efa2fa38e95">&#9670;&#160;</a></span>lastChange_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t KeypadShield::lastChange_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Last time (in ms) when the raw key state changed, used for debouncing. </p>

</div>
</div>
<a id="a614301cd9c76980a5c4c6baa5ca1b5b5" name="a614301cd9c76980a5c4c6baa5ca1b5b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a614301cd9c76980a5c4c6baa5ca1b5b5">&#9670;&#160;</a></span>stable_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5">Key</a> KeypadShield::stable_ = <a class="el" href="KeypadShield_8h.html#a8c91b08661656e1fbbfc7c1309c154c5ab50339a10e1de285ac99d4c3990b8693">Key::NONE</a></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Current stable (debounced) key state. </p>

</div>
</div>
<a id="a3e1066ddc2d6fee749b2ada3808f47a1" name="a3e1066ddc2d6fee749b2ada3808f47a1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3e1066ddc2d6fee749b2ada3808f47a1">&#9670;&#160;</a></span>thDown_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int KeypadShield::thDown_ = 400</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a8295c6e1eb946b0b0d6bf3127e47ba8c" name="a8295c6e1eb946b0b0d6bf3127e47ba8c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8295c6e1eb946b0b0d6bf3127e47ba8c">&#9670;&#160;</a></span>thLeft_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int KeypadShield::thLeft_ = 600</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a3ba1a5789b7b14c8ec9cb45cf1306840" name="a3ba1a5789b7b14c8ec9cb45cf1306840"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a3ba1a5789b7b14c8ec9cb45cf1306840">&#9670;&#160;</a></span>thRight_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int KeypadShield::thRight_ = 60</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>ADC thresholds used to distinguish keys. </p>

</div>
</div>
<a id="a7a0c30915ca0d9ad2f2532308e79b6ce" name="a7a0c30915ca0d9ad2f2532308e79b6ce"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7a0c30915ca0d9ad2f2532308e79b6ce">&#9670;&#160;</a></span>thSel_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int KeypadShield::thSel_ = 800</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<a id="a2dee94d9217872f4d7a84de450d8b9e2" name="a2dee94d9217872f4d7a84de450d8b9e2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2dee94d9217872f4d7a84de450d8b9e2">&#9670;&#160;</a></span>thUp_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int KeypadShield::thUp_ = 200</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="KeypadShield_8h_source.html">KeypadShield.h</a></li>
<li><a class="el" href="KeypadShield_8cpp.html">KeypadShield.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
