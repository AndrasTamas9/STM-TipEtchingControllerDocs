<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>STM Tip Etching Controller: HomeMode Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">STM Tip Etching Controller
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classHomeMode-members.html">List of all members</a>  </div>
  <div class="headertitle"><div class="title">HomeMode Class Reference</div></div>
</div><!--header-->
<div class="contents">

<p>Homing mode for the Z axis with baseline current measurement.  
 <a href="classHomeMode.html#details">More...</a></p>

<p><code>#include &lt;<a class="el" href="Modes_8h_source.html">Modes.h</a>&gt;</code></p>
<div class="dynheader">
Inheritance diagram for HomeMode:</div>
<div class="dyncontent">
<div class="center"><img src="classHomeMode__inherit__graph.png" border="0" usemap="#aHomeMode_inherit__map" alt="Inheritance graph"/></div>
<map name="aHomeMode_inherit__map" id="aHomeMode_inherit__map">
<area shape="rect" title="Homing mode for the Z axis with baseline current measurement." alt="" coords="5,79,103,104"/>
<area shape="rect" href="structIMode.html" title="Interface for non&#45;blocking machine modes." alt="" coords="23,5,85,31"/>
<area shape="poly" title=" " alt="" coords="57,44,57,79,51,79,51,44"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<div class="dynheader">
Collaboration diagram for HomeMode:</div>
<div class="dyncontent">
<div class="center"><img src="classHomeMode__coll__graph.png" border="0" usemap="#aHomeMode_coll__map" alt="Collaboration graph"/></div>
<map name="aHomeMode_coll__map" id="aHomeMode_coll__map">
<area shape="rect" title="Homing mode for the Z axis with baseline current measurement." alt="" coords="140,93,237,119"/>
<area shape="rect" href="structIMode.html" title="Interface for non&#45;blocking machine modes." alt="" coords="5,5,68,31"/>
<area shape="poly" title=" " alt="" coords="70,35,169,91,167,95,68,40"/>
<area shape="rect" href="classLcd1602.html" title="Wrapper class for a 16x2 HD44780&#45;compatible LCD with PWM backlight control." alt="" coords="92,5,168,31"/>
<area shape="poly" title=" " alt="" coords="148,41,183,91,178,94,143,44"/>
<area shape="rect" href="classStepperDriver.html" title="Non&#45;blocking stepper motor driver with position and velocity control." alt="" coords="193,5,305,31"/>
<area shape="poly" title=" " alt="" coords="235,44,199,94,195,91,230,41"/>
<area shape="rect" href="classCurrentSensor.html" title="Non&#45;blocking RMS current measurement helper class." alt="" coords="329,5,443,31"/>
<area shape="poly" title=" " alt="" coords="355,40,290,72,226,96,224,91,288,67,353,35"/>
</map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pub-methods" name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a826e4c67e295ed49261d8cf2c3143ebb" id="r_a826e4c67e295ed49261d8cf2c3143ebb"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a826e4c67e295ed49261d8cf2c3143ebb">HomeMode</a> (<a class="el" href="classLcd1602.html">Lcd1602</a> &amp;lcd, <a class="el" href="classStepperDriver.html">StepperDriver</a> &amp;stepper, uint8_t limitPin, <a class="el" href="classCurrentSensor.html">CurrentSensor</a> &amp;current)</td></tr>
<tr class="memdesc:a826e4c67e295ed49261d8cf2c3143ebb"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct a new <a class="el" href="classHomeMode.html" title="Homing mode for the Z axis with baseline current measurement.">HomeMode</a> instance.  <br /></td></tr>
<tr class="separator:a826e4c67e295ed49261d8cf2c3143ebb"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a8d998169f0d1e30a0aebad2e7092dd1a" id="r_a8d998169f0d1e30a0aebad2e7092dd1a"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a8d998169f0d1e30a0aebad2e7092dd1a">name</a> () const override</td></tr>
<tr class="memdesc:a8d998169f0d1e30a0aebad2e7092dd1a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Get the name of this mode.  <br /></td></tr>
<tr class="separator:a8d998169f0d1e30a0aebad2e7092dd1a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab15a4de72b54a3a96bf7691259f14e00" id="r_ab15a4de72b54a3a96bf7691259f14e00"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#ab15a4de72b54a3a96bf7691259f14e00">begin</a> () override</td></tr>
<tr class="memdesc:ab15a4de72b54a3a96bf7691259f14e00"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the HOME mode.  <br /></td></tr>
<tr class="separator:ab15a4de72b54a3a96bf7691259f14e00"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6f709c817816acbc6a1e2e8f2cba30c1" id="r_a6f709c817816acbc6a1e2e8f2cba30c1"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a6f709c817816acbc6a1e2e8f2cba30c1">step</a> () override</td></tr>
<tr class="memdesc:a6f709c817816acbc6a1e2e8f2cba30c1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute one non-blocking step of the HOME mode state machine.  <br /></td></tr>
<tr class="separator:a6f709c817816acbc6a1e2e8f2cba30c1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fb3362016453bd5a2e6eda2f1f2918f" id="r_a1fb3362016453bd5a2e6eda2f1f2918f"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a1fb3362016453bd5a2e6eda2f1f2918f">end</a> () override</td></tr>
<tr class="memdesc:a1fb3362016453bd5a2e6eda2f1f2918f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Cleanup performed when exiting HOME mode.  <br /></td></tr>
<tr class="separator:a1fb3362016453bd5a2e6eda2f1f2918f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="inherit_header pub_methods_structIMode"><td colspan="2" onclick="javascript:toggleInherit('pub_methods_structIMode')"><img src="closed.png" alt="-"/>&#160;Public Member Functions inherited from <a class="el" href="structIMode.html">IMode</a></td></tr>
<tr class="memitem:aa6d28f0a2c76d54fa7cc452b5efee520 inherit pub_methods_structIMode" id="r_aa6d28f0a2c76d54fa7cc452b5efee520"><td class="memItemLeft" align="right" valign="top">virtual&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structIMode.html#aa6d28f0a2c76d54fa7cc452b5efee520">~IMode</a> ()</td></tr>
<tr class="memdesc:aa6d28f0a2c76d54fa7cc452b5efee520 inherit pub_methods_structIMode"><td class="mdescLeft">&#160;</td><td class="mdescRight">Virtual destructor for proper cleanup via base pointers.  <br /></td></tr>
<tr class="separator:aa6d28f0a2c76d54fa7cc452b5efee520 inherit pub_methods_structIMode"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="pri-attribs" name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:acf90d8a2712c94fd2affb9f5c8bb20bd" id="r_acf90d8a2712c94fd2affb9f5c8bb20bd"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classLcd1602.html">Lcd1602</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#acf90d8a2712c94fd2affb9f5c8bb20bd">lcd_</a></td></tr>
<tr class="memdesc:acf90d8a2712c94fd2affb9f5c8bb20bd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to the LCD used for status messages.  <br /></td></tr>
<tr class="separator:acf90d8a2712c94fd2affb9f5c8bb20bd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3d70076620a06a871d25733a3114e2c" id="r_ad3d70076620a06a871d25733a3114e2c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classStepperDriver.html">StepperDriver</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#ad3d70076620a06a871d25733a3114e2c">stepper_</a></td></tr>
<tr class="memdesc:ad3d70076620a06a871d25733a3114e2c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to the stepper driver implementing motion control.  <br /></td></tr>
<tr class="separator:ad3d70076620a06a871d25733a3114e2c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acd48016409acafc580570814a21d6cc4" id="r_acd48016409acafc580570814a21d6cc4"><td class="memItemLeft" align="right" valign="top">uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#acd48016409acafc580570814a21d6cc4">limitPin_</a></td></tr>
<tr class="memdesc:acd48016409acafc580570814a21d6cc4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Digital input pin connected to the homing limit switch.  <br /></td></tr>
<tr class="separator:acd48016409acafc580570814a21d6cc4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2a6d8063894e9a909009b1a8b16a1112" id="r_a2a6d8063894e9a909009b1a8b16a1112"><td class="memItemLeft" align="right" valign="top"><a class="el" href="classCurrentSensor.html">CurrentSensor</a> &amp;&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a2a6d8063894e9a909009b1a8b16a1112">current_</a></td></tr>
<tr class="memdesc:a2a6d8063894e9a909009b1a8b16a1112"><td class="mdescLeft">&#160;</td><td class="mdescRight">Reference to the current sensor for baseline measurement.  <br /></td></tr>
<tr class="separator:a2a6d8063894e9a909009b1a8b16a1112"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4174c2e6871a8bd1318d489b21cc5c64" id="r_a4174c2e6871a8bd1318d489b21cc5c64"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a4174c2e6871a8bd1318d489b21cc5c64">homed_</a> = false</td></tr>
<tr class="memdesc:a4174c2e6871a8bd1318d489b21cc5c64"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag indicating whether the homing sequence has finished.  <br /></td></tr>
<tr class="separator:a4174c2e6871a8bd1318d489b21cc5c64"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5836b1c55e76573ba0feec67ae95dbc2" id="r_a5836b1c55e76573ba0feec67ae95dbc2"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a5836b1c55e76573ba0feec67ae95dbc2">target_</a> = 0.0f</td></tr>
<tr class="memdesc:a5836b1c55e76573ba0feec67ae95dbc2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Target Z position (e.g. 30 mm) for baseline measurement.  <br /></td></tr>
<tr class="separator:a5836b1c55e76573ba0feec67ae95dbc2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:add37b5f07d9636bfd143990b78bf81b5" id="r_add37b5f07d9636bfd143990b78bf81b5"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#add37b5f07d9636bfd143990b78bf81b5">baselineMeasuring_</a> = false</td></tr>
<tr class="memdesc:add37b5f07d9636bfd143990b78bf81b5"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag indicating that baseline current measurement is in progress.  <br /></td></tr>
<tr class="separator:add37b5f07d9636bfd143990b78bf81b5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1df98fa0931808eb882210d054b37d06" id="r_a1df98fa0931808eb882210d054b37d06"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a1df98fa0931808eb882210d054b37d06">baselineDone_</a> = false</td></tr>
<tr class="memdesc:a1df98fa0931808eb882210d054b37d06"><td class="mdescLeft">&#160;</td><td class="mdescRight">Flag indicating that baseline current measurement has finished.  <br /></td></tr>
<tr class="separator:a1df98fa0931808eb882210d054b37d06"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6766aeb9c224266a6f3fefcc1bf511c7" id="r_a6766aeb9c224266a6f3fefcc1bf511c7"><td class="memItemLeft" align="right" valign="top">unsigned long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a6766aeb9c224266a6f3fefcc1bf511c7">baselineStart_</a> = 0</td></tr>
<tr class="memdesc:a6766aeb9c224266a6f3fefcc1bf511c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start time (in ms) of the baseline measurement window.  <br /></td></tr>
<tr class="separator:a6766aeb9c224266a6f3fefcc1bf511c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0db329a40b985445c1fd218a57c57b8f" id="r_a0db329a40b985445c1fd218a57c57b8f"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a0db329a40b985445c1fd218a57c57b8f">baselineSum_</a> = 0.0f</td></tr>
<tr class="memdesc:a0db329a40b985445c1fd218a57c57b8f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Accumulated sum of RMS current samples during baseline measurement.  <br /></td></tr>
<tr class="separator:a0db329a40b985445c1fd218a57c57b8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0f563b00659ae4f315055ef48484f977" id="r_a0f563b00659ae4f315055ef48484f977"><td class="memItemLeft" align="right" valign="top">uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classHomeMode.html#a0f563b00659ae4f315055ef48484f977">baselineCount_</a> = 0</td></tr>
<tr class="memdesc:a0f563b00659ae4f315055ef48484f977"><td class="mdescLeft">&#160;</td><td class="mdescRight">Number of RMS samples accumulated into baselineSum_.  <br /></td></tr>
<tr class="separator:a0f563b00659ae4f315055ef48484f977"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Homing mode for the Z axis with baseline current measurement. </p>
<p>Responsibilities:</p><ul>
<li>Perform a homing motion by driving the stepper towards a limit switch, then zeroing the position.</li>
<li>Move to a predefined target height (e.g. Z = 30 mm).</li>
<li>At that position, perform a multi-second RMS current measurement using <a class="el" href="classCurrentSensor.html" title="Non-blocking RMS current measurement helper class.">CurrentSensor</a> in order to establish a baseline (no-load) current.</li>
<li>Store the result in the global baselineCurrent variable. </li>
</ul>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a826e4c67e295ed49261d8cf2c3143ebb" name="a826e4c67e295ed49261d8cf2c3143ebb"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a826e4c67e295ed49261d8cf2c3143ebb">&#9670;&#160;</a></span>HomeMode()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">HomeMode::HomeMode </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="classLcd1602.html">Lcd1602</a> &amp;&#160;</td>
          <td class="paramname"><em>lcd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classStepperDriver.html">StepperDriver</a> &amp;&#160;</td>
          <td class="paramname"><em>stepper</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">uint8_t&#160;</td>
          <td class="paramname"><em>limitPin</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="classCurrentSensor.html">CurrentSensor</a> &amp;&#160;</td>
          <td class="paramname"><em>current</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct a new <a class="el" href="classHomeMode.html" title="Homing mode for the Z axis with baseline current measurement.">HomeMode</a> instance. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">lcd</td><td>Reference to the LCD helper used for user feedback. </td></tr>
    <tr><td class="paramname">stepper</td><td>Reference to the stepper driver controlling the Z axis. </td></tr>
    <tr><td class="paramname">limitPin</td><td>Digital input pin connected to the homing limit switch. </td></tr>
    <tr><td class="paramname">current</td><td>Reference to the current sensor used to measure baseline. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="ab15a4de72b54a3a96bf7691259f14e00" name="ab15a4de72b54a3a96bf7691259f14e00"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ab15a4de72b54a3a96bf7691259f14e00">&#9670;&#160;</a></span>begin()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void HomeMode::begin </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Initialize the HOME mode. </p>
<p>Initialize the HOME mode and start the homing procedure.</p>
<p>Sets up LCD messages, configures the limit switch pin, enables the stepper, and resets internal flags and accumulators for the homing and baseline measurement sequence.</p>
<p>Behavior:</p><ul>
<li>Displays a homing status message on the LCD.</li>
<li>Configures the limit switch pin with INPUT_PULLUP.</li>
<li>Enables the stepper driver and starts moving downward at a fixed speed until the limit switch is hit.</li>
<li>Initializes all flags and accumulators for the baseline current measurement that will be performed later at Z = 30 mm. </li>
</ul>

<p>Implements <a class="el" href="structIMode.html#abf4c7c5e1758fc13058dac1dd0675982">IMode</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classHomeMode_ab15a4de72b54a3a96bf7691259f14e00_cgraph.png" border="0" usemap="#aclassHomeMode_ab15a4de72b54a3a96bf7691259f14e00_cgraph" alt=""/></div>
<map name="aclassHomeMode_ab15a4de72b54a3a96bf7691259f14e00_cgraph" id="aclassHomeMode_ab15a4de72b54a3a96bf7691259f14e00_cgraph">
<area shape="rect" title="Initialize the HOME mode." alt="" coords="5,63,147,88"/>
<area shape="rect" href="classStepperDriver.html#a08ddf3dd4e038a8818de8a7200ddb4ec" title="Enable or disable the stepper driver." alt="" coords="215,5,379,31"/>
<area shape="poly" title=" " alt="" coords="122,60,194,41,231,31,232,37,195,46,124,65"/>
<area shape="rect" href="classStepperDriver.html#a8fa4f67459e8366e83a2827fc4e8cf3a" title="Set continuous motion speed in mm/s." alt="" coords="195,55,400,95"/>
<area shape="poly" title=" " alt="" coords="147,73,181,73,181,78,147,78"/>
<area shape="rect" href="classLcd1602.html#a7004efb68a9891924331923c69706d52" title="Display two lines of flash&#45;resident text as a title." alt="" coords="238,120,357,145"/>
<area shape="poly" title=" " alt="" coords="124,85,195,105,232,114,231,119,194,110,122,91"/>
</map>
</div>

</div>
</div>
<a id="a1fb3362016453bd5a2e6eda2f1f2918f" name="a1fb3362016453bd5a2e6eda2f1f2918f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fb3362016453bd5a2e6eda2f1f2918f">&#9670;&#160;</a></span>end()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void HomeMode::end </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Cleanup performed when exiting HOME mode. </p>
<p>Cleanup performed when leaving HOME mode.</p>
<p>Typically ensures the stepper driver remains in a safe, enabled state.</p>
<p>Currently:</p><ul>
<li>Ensures the stepper driver remains enabled.</li>
<li>Does not change position or speed (the caller is expected to handle this). </li>
</ul>

<p>Implements <a class="el" href="structIMode.html#acc782a6205322e642a56aa122c8e0512">IMode</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classHomeMode_a1fb3362016453bd5a2e6eda2f1f2918f_cgraph.png" border="0" usemap="#aclassHomeMode_a1fb3362016453bd5a2e6eda2f1f2918f_cgraph" alt=""/></div>
<map name="aclassHomeMode_a1fb3362016453bd5a2e6eda2f1f2918f_cgraph" id="aclassHomeMode_a1fb3362016453bd5a2e6eda2f1f2918f_cgraph">
<area shape="rect" title="Cleanup performed when exiting HOME mode." alt="" coords="5,5,135,31"/>
<area shape="rect" href="classStepperDriver.html#a08ddf3dd4e038a8818de8a7200ddb4ec" title="Enable or disable the stepper driver." alt="" coords="183,5,347,31"/>
<area shape="poly" title=" " alt="" coords="135,15,169,15,169,21,135,21"/>
</map>
</div>

</div>
</div>
<a id="a8d998169f0d1e30a0aebad2e7092dd1a" name="a8d998169f0d1e30a0aebad2e7092dd1a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8d998169f0d1e30a0aebad2e7092dd1a">&#9670;&#160;</a></span>name()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">const char * HomeMode::name </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td> const</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Get the name of this mode. </p>
<dl class="section return"><dt>Returns</dt><dd>Constant C-string "HOME". </dd></dl>

<p>Implements <a class="el" href="structIMode.html#a531317dbb9f073f46bd6b7330ffc58e7">IMode</a>.</p>

</div>
</div>
<a id="a6f709c817816acbc6a1e2e8f2cba30c1" name="a6f709c817816acbc6a1e2e8f2cba30c1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6f709c817816acbc6a1e2e8f2cba30c1">&#9670;&#160;</a></span>step()</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool HomeMode::step </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">override</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute one non-blocking step of the HOME mode state machine. </p>
<p>Perform one step of the HOME mode state machine.</p>
<p>Drives the homing sequence and, once homed, manages the baseline current measurement phase. This function should be called repeatedly until it returns true, indicating that homing and baseline measurement are complete.</p>
<dl class="section return"><dt>Returns</dt><dd>true if HOME mode has completed and control can return to the menu, </dd>
<dd>
false otherwise.</dd></dl>
<p>The homing logic proceeds through several phases:</p><ol type="1">
<li>Move downward until the limit switch is triggered, then:<ul>
<li>stop the motor,</li>
<li>set Z = 0,</li>
<li>move upward to Z = 30 mm.</li>
</ul>
</li>
<li>Once at Z = 30 mm, perform a 5 s baseline current measurement with the stepper motor stationary:<ul>
<li>enable current measurement,</li>
<li>accumulate RMS current readings over the measurement period.</li>
</ul>
</li>
<li>After 5 s:<ul>
<li>disable current measurement,</li>
<li>compute the average baseline current,</li>
<li>store it in the global baselineCurrent,</li>
<li>display the result.</li>
</ul>
</li>
<li>After a short delay, the mode reports completion.</li>
</ol>
<dl class="section return"><dt>Returns</dt><dd>true when the homing process and baseline measurement are complete, </dd>
<dd>
false otherwise, meaning the mode should continue to run. </dd></dl>

<p>Implements <a class="el" href="structIMode.html#a9fc61504224e0961d659341cde1140da">IMode</a>.</p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="classHomeMode_a6f709c817816acbc6a1e2e8f2cba30c1_cgraph.png" border="0" usemap="#aclassHomeMode_a6f709c817816acbc6a1e2e8f2cba30c1_cgraph" alt=""/></div>
<map name="aclassHomeMode_a6f709c817816acbc6a1e2e8f2cba30c1_cgraph" id="aclassHomeMode_a6f709c817816acbc6a1e2e8f2cba30c1_cgraph">
<area shape="rect" title="Execute one non&#45;blocking step of the HOME mode state machine." alt="" coords="5,228,139,253"/>
<area shape="rect" href="classLcd1602.html#a3f963d042026926a4a7957d804fff527" title="Clear the LCD display." alt="" coords="237,5,353,31"/>
<area shape="poly" title=" " alt="" coords="74,227,86,189,108,138,141,85,161,61,185,40,203,29,223,22,225,27,205,34,188,44,165,64,145,88,113,141,91,191,79,228"/>
<area shape="rect" href="classCurrentSensor.html#ab1cf6c33a21ba788b1801f89e10e88dd" title="Get the last computed RMS current." alt="" coords="208,55,383,80"/>
<area shape="poly" title=" " alt="" coords="77,227,92,198,115,160,147,122,185,89,196,83,198,88,188,94,151,125,120,163,96,200,82,229"/>
<area shape="rect" href="classStepperDriver.html#a4d1715971817716be1a64e8b5c6c2197" title="Get the current logical position in millimeters." alt="" coords="197,104,394,129"/>
<area shape="poly" title=" " alt="" coords="82,226,124,183,153,159,185,138,202,131,204,136,188,143,156,163,127,187,86,230"/>
<area shape="rect" href="classLcd1602.html#a2922193bbb32f7cad2c48c5ad0f21f0c" title="Print a RAM&#45;resident C&#45;string." alt="" coords="238,153,353,179"/>
<area shape="poly" title=" " alt="" coords="97,226,138,206,186,187,224,177,225,182,188,193,140,211,99,230"/>
<area shape="rect" href="classLcd1602.html#a0516b78aa7f4531924a132d2b256f534" title="Position the cursor." alt="" coords="222,203,369,228"/>
<area shape="poly" title=" " alt="" coords="139,230,208,223,209,228,139,236"/>
<area shape="rect" href="classCurrentSensor.html#a908e354d16c44c67d2be1b501e18bfc7" title="Enable or disable measurement updates." alt="" coords="198,252,393,277"/>
<area shape="poly" title=" " alt="" coords="139,245,184,250,184,255,139,250"/>
<area shape="rect" href="classStepperDriver.html#a3e0de882544ae00db697731210f161c8" title="Set the logical position in millimeters." alt="" coords="187,301,404,327"/>
<area shape="poly" title=" " alt="" coords="101,251,188,286,220,295,218,301,186,291,99,256"/>
<area shape="rect" href="classStepperDriver.html#a8fa4f67459e8366e83a2827fc4e8cf3a" title="Set continuous motion speed in mm/s." alt="" coords="193,351,398,391"/>
<area shape="poly" title=" " alt="" coords="87,252,129,293,157,316,188,336,204,344,202,348,185,340,154,320,126,297,83,256"/>
<area shape="rect" href="classLcd1602.html#a7004efb68a9891924331923c69706d52" title="Display two lines of flash&#45;resident text as a title." alt="" coords="236,416,355,441"/>
<area shape="poly" title=" " alt="" coords="81,253,95,283,118,324,149,366,188,401,224,417,221,422,185,406,145,370,114,327,90,286,76,255"/>
<area shape="rect" href="classStepperDriver.html#ac202361e6f613a083200d36f664d64e7" title="Non&#45;blocking step scheduling; call frequently from loop()." alt="" coords="213,465,378,491"/>
<area shape="poly" title=" " alt="" coords="79,253,90,292,111,346,144,403,164,428,188,451,202,459,199,464,185,455,160,432,139,406,106,348,85,294,74,254"/>
<area shape="rect" href="classStepperDriver.html#acb72803a8fdbf2bd2e645b36a3d0306c" title="Emit a single step pulse and update the internal position counter." alt="" coords="452,465,640,491"/>
<area shape="poly" title=" " alt="" coords="378,475,438,475,438,481,378,481"/>
</map>
</div>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a0f563b00659ae4f315055ef48484f977" name="a0f563b00659ae4f315055ef48484f977"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0f563b00659ae4f315055ef48484f977">&#9670;&#160;</a></span>baselineCount_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint32_t HomeMode::baselineCount_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Number of RMS samples accumulated into baselineSum_. </p>

</div>
</div>
<a id="a1df98fa0931808eb882210d054b37d06" name="a1df98fa0931808eb882210d054b37d06"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1df98fa0931808eb882210d054b37d06">&#9670;&#160;</a></span>baselineDone_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool HomeMode::baselineDone_ = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag indicating that baseline current measurement has finished. </p>

</div>
</div>
<a id="add37b5f07d9636bfd143990b78bf81b5" name="add37b5f07d9636bfd143990b78bf81b5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#add37b5f07d9636bfd143990b78bf81b5">&#9670;&#160;</a></span>baselineMeasuring_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool HomeMode::baselineMeasuring_ = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag indicating that baseline current measurement is in progress. </p>

</div>
</div>
<a id="a6766aeb9c224266a6f3fefcc1bf511c7" name="a6766aeb9c224266a6f3fefcc1bf511c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a6766aeb9c224266a6f3fefcc1bf511c7">&#9670;&#160;</a></span>baselineStart_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">unsigned long HomeMode::baselineStart_ = 0</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Start time (in ms) of the baseline measurement window. </p>

</div>
</div>
<a id="a0db329a40b985445c1fd218a57c57b8f" name="a0db329a40b985445c1fd218a57c57b8f"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0db329a40b985445c1fd218a57c57b8f">&#9670;&#160;</a></span>baselineSum_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float HomeMode::baselineSum_ = 0.0f</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Accumulated sum of RMS current samples during baseline measurement. </p>

</div>
</div>
<a id="a2a6d8063894e9a909009b1a8b16a1112" name="a2a6d8063894e9a909009b1a8b16a1112"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2a6d8063894e9a909009b1a8b16a1112">&#9670;&#160;</a></span>current_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classCurrentSensor.html">CurrentSensor</a>&amp; HomeMode::current_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to the current sensor for baseline measurement. </p>

</div>
</div>
<a id="a4174c2e6871a8bd1318d489b21cc5c64" name="a4174c2e6871a8bd1318d489b21cc5c64"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4174c2e6871a8bd1318d489b21cc5c64">&#9670;&#160;</a></span>homed_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool HomeMode::homed_ = false</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Flag indicating whether the homing sequence has finished. </p>

</div>
</div>
<a id="acf90d8a2712c94fd2affb9f5c8bb20bd" name="acf90d8a2712c94fd2affb9f5c8bb20bd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acf90d8a2712c94fd2affb9f5c8bb20bd">&#9670;&#160;</a></span>lcd_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classLcd1602.html">Lcd1602</a>&amp; HomeMode::lcd_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to the LCD used for status messages. </p>

</div>
</div>
<a id="acd48016409acafc580570814a21d6cc4" name="acd48016409acafc580570814a21d6cc4"></a>
<h2 class="memtitle"><span class="permalink"><a href="#acd48016409acafc580570814a21d6cc4">&#9670;&#160;</a></span>limitPin_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">uint8_t HomeMode::limitPin_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Digital input pin connected to the homing limit switch. </p>

</div>
</div>
<a id="ad3d70076620a06a871d25733a3114e2c" name="ad3d70076620a06a871d25733a3114e2c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad3d70076620a06a871d25733a3114e2c">&#9670;&#160;</a></span>stepper_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="classStepperDriver.html">StepperDriver</a>&amp; HomeMode::stepper_</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Reference to the stepper driver implementing motion control. </p>

</div>
</div>
<a id="a5836b1c55e76573ba0feec67ae95dbc2" name="a5836b1c55e76573ba0feec67ae95dbc2"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5836b1c55e76573ba0feec67ae95dbc2">&#9670;&#160;</a></span>target_</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">float HomeMode::target_ = 0.0f</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Target Z position (e.g. 30 mm) for baseline measurement. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following files:<ul>
<li><a class="el" href="Modes_8h_source.html">Modes.h</a></li>
<li><a class="el" href="Modes_8cpp.html">Modes.cpp</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8
</small></address>
</body>
</html>
